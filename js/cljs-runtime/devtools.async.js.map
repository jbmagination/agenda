{"version":3,"sources":["devtools/async.cljs"],"sourcesContent":["(ns devtools.async\n  (:require-macros [devtools.oops :refer [oset ocall]])\n  (:require [goog.async.nextTick :as next-tick]))\n\n(defn ^:dynamic available? []\n  (exists? js/Promise))\n\n(def ^:dynamic *installed* false)\n(def ^:dynamic *original-set-immediate* nil)\n\n; see http://stackoverflow.com/a/30741722/84283\n(defn rethrow-outside-promise [e]\n  (js/setTimeout #(throw e) 0))\n\n(defn promise-based-set-immediate [callback]\n  (-> (ocall js/Promise \"resolve\")\n      (ocall \"then\" callback)\n      (ocall \"catch\" rethrow-outside-promise))\n  nil)\n\n(defn install-async-set-immediate! []\n  (set! *original-set-immediate* next-tick/setImmediate_)\n  (set! next-tick/setImmediate_ promise-based-set-immediate))\n\n(defn uninstall-async-set-immediate! []\n  (set! next-tick/setImmediate_ *original-set-immediate*))\n\n; -- installation -----------------------------------------------------------------------------------------------------------\n\n(defn installed? []\n  *installed*)\n\n(defn install! []\n  (when-not *installed*\n    (set! *installed* true)\n    (oset js/Error [\"stackTraceLimit\"] js/Infinity)\n    (install-async-set-immediate!)\n    true))\n\n(defn uninstall! []\n  (when *installed*\n    (set! *installed* false)\n    (uninstall-async-set-immediate!)))\n"],"mappings":";;;AAIA,kCAAA,lCAAgBA;AAAhB,AACE,eAAAC;;AAEF,uCAAA,vCAAeC;AACf,oDAAA,pDAAeC;AAGf,yCAAA,zCAAMC,0FAAyBC;AAA/B,AACE,kBAAA,XAACC;AAAD,AAAgB,MAAOD;GAAvB;;AAEF,6CAAA,7CAAME,kGAA6BC;AAAnC,iEACM,iBAAAC,mBAAOR,xEACP,iBAAAQ,9CACA,IAAAA;AAFA,AAAA,OAAA,CAAAA,iBAAA,iBAAAA;;AACA,AAAA,OAAA,CAAAA,iBAAA,cAAAA,iBAAcD;;AACd,AAAA,AAAA,CAAAC,uBAAA,eAAAA,uBAAeL;;AAHrB;;AAMA,mDAAA,nDAAMM;AAAN,AACE,AAAMP,oDAAyBQ;;AAC/B,OAAMA,oCAAwBJ;;AAEhC,qDAAA,rDAAMK;AAAN,AACE,OAAMD,oCAAwBR;;AAIhC,kCAAA,lCAAMU;AAAN,AACEX;;AAEF,+BAAA,/BAAMY;AAAN,AACE,GAAUZ;AAAV;;AAAA,AACE,uCAAA,vCAAMA;;AACN,IAAAa,iBAAME;IAAND,8BAAAD;AAAA,AAAA,oBAAAC;AAAA;AAAA,AAAA,MAAA,KAAAC,MAAA,CAAA,8DAAA,CAAA,4EAAA,MAAA,mDAAAF,2BAAA,KAAA;;;AAAA,CAAAC,4BAAA,qBAAmCE;;AAAnCH;AACA,AAACL;;AAHH;;;AAMF,iCAAA,jCAAMS;AAAN,AACE,GAAMjB;AAAN,AACE,uCAAA,vCAAMA;;AACN,OAACU;;AAFH","names":["devtools.async/available?","js/Promise","devtools.async/*installed*","devtools.async/*original-set-immediate*","devtools.async/rethrow-outside-promise","e","js/setTimeout","devtools.async/promise-based-set-immediate","callback","o__12576__auto__","devtools.async/install-async-set-immediate!","goog.async.nextTick/setImmediate_","devtools.async/uninstall-async-set-immediate!","devtools.async/installed?","devtools.async/install!","G__14852","target__12599__auto__","js/Error","js/Infinity","devtools.async/uninstall!"]}