{"version":3,"sources":["gearnut/events.cljs"],"sourcesContent":["(ns gearnut.events\n  (:require\n   [ajax.core :as ajax]\n   [day8.re-frame.http-fx]\n   [re-frame.core :as re-frame]\n   [gearnut.coeffects]\n   [gearnut.db :as db]))\n\n(re-frame/reg-event-db\n ::initialize-db\n (fn [_ _]\n   db/default-db))\n\n(defn handle-lookup-response\n  [db [name response]]\n  (-> db\n      (assoc :lookup-data response\n             :lookup-response-type name)))\n\n(re-frame/reg-event-db\n ::process-response\n (fn [db event]\n   (handle-lookup-response db event)))\n\n\n(re-frame/reg-event-db\n ::bad-response\n (fn [db event]\n   (handle-lookup-response db event)))\n\n(defn handle-lookup-event\n  ;; event handler for product URL lookup\n  [coeffects event]\n  (println coeffects)\n  {:db (assoc (:db coeffects) :url (:url coeffects))\n   :http-xhrio {:method :get\n                :uri (:url coeffects)\n                :timeout 8000\n                :response-format (ajax/text-response-format)\n                :on-success [::process-response]\n                :on-failure [::bad-response]}})\n\n(re-frame/reg-event-fx\n ::lookup\n [(re-frame/inject-cofx :gearnut.coeffects/dom-value-by-id :url)]\n handle-lookup-event)\n\n\n(defn on-file-load [db event]\n  (let [reader (.-target event)\n        file-content (.-result reader)]\n    file-content))\n\n#_(re-frame/reg-event-db\n   ::file-chosen\n   (fn [db event]\n     (let [file  (.item (.-files (.getElementById js/document \"starter-image-picker\")) 0)\n           reader (js/FileReader.)\n           onload (fn [event] (on-file-load db event))\n           _ (aset reader \"onload\" onload)\n           content (.readAsDataURL reader file)]\n       (assoc db :starter-image content))))\n\n\n\n(re-frame/reg-event-db\n ::file-chosen\n (fn [db event]\n   (let [file  (.item (.-files (.getElementById js/document \"starter-image-picker\")) 0)\n         content (js/URL.createObjectURL file)]\n     (assoc db :starter-image content))))\n\n\n;;URL.createObjectURL(document.getElementById(\"fileInput\").files[0]);\n"],"mappings":";;;;;;;AAQA,yDAAA,zDAACA,2JAEA,WAAKC,EAAEA;AAAP,AACEC;;AAEH,wCAAA,mDAAAC,3FAAMG,wFACHC;AADH,AAAA,IAAAH,aAAAD;WAAA,AAAAE,4CAAAD,WAAA,IAAA,lEACOI;eADP,AAAAH,4CAAAD,WAAA,IAAA,tEACYK;AADZ,4DAEMF,5DACA,+DAAA,+HAAA,vLAACG,4HAAmBD,+IACSD;;AAEnC,yDAAA,zDAACR,iKAEA,WAAKO,GAAGI;AAAR,AACE,OAACL,sCAAuBC,GAAGI;;AAG9B,yDAAA,zDAACX,0JAEA,WAAKO,GAAGI;AAAR,AACE,OAACL,sCAAuBC,GAAGI;;AAE9B,qCAAA,rCAAMC,kFAEHC,UAAUF;AAFb,AAGE,AAACG,yGAAQD;;AAHX,kDAAA,qUAAA,iEAAA,2CAAA,uDAAA,mDAAA,8IAAA,2DAAA,OAAA,uPAAA,iEAAA,mFAAA,gHAAA,gEAAA,mFAAA,z0CAIO,uIAAA,vIAACE,8CAAM,AAAA,8EAAKF,6DAAgB,AAAA,gFAAMA,qRAEpB,AAAA,gFAAMA,wJAEM,CAACG,+DAAAA,iEAAAA;;AAIlC,yDAAA,kFAAA,3IAACC,8NAEC,iBAAAC,WAAA;IAAAC,WAAA;AAAA,AAAA,0HAAAD,SAAAC,gDAAAD,SAAAC,pLAACC,0DAAAA,6EAAAA;aACFR;AAGD,8BAAA,9BAAMS,oEAAcd,GAAGI;AAAvB,AACE,IAAMW,SAAO,AAAUX;IACjBY,eAAa,AAAUD;AAD7B,AAEEC;;AAcJ,yDAAA,zDAACvB,uJAEA,WAAKO,GAAGI;AAAR,AACE,IAAMa,OAAM,2DAAA,3DAAO,AAAS,wBAAA,xBAAiBC;IACvCC,UAAQ,AAACC,oBAAuBH;AADtC,AAEE,wDAAA,jDAACT,8CAAMR,2EAAkBmB","names":["re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$2","_","gearnut.db/default-db","p__13863","vec__13864","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","gearnut.events/handle-lookup-response","db","name","response","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic","event","gearnut.events/handle-lookup-event","coeffects","cljs.core.println.cljs$core$IFn$_invoke$arity$variadic","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","ajax.core/text-response-format","re_frame.core.reg_event_fx.cljs$core$IFn$_invoke$arity$3","G__13867","G__13868","re-frame.core/inject-cofx","gearnut.events/on-file-load","reader","file-content","file","js/document","content","js/URL.createObjectURL"]}