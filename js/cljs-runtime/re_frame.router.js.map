{"version":3,"sources":["re_frame/router.cljc"],"sourcesContent":["(ns re-frame.router\n  (:require [re-frame.events  :refer [handle]]\n            [re-frame.interop :refer [after-render empty-queue next-tick]]\n            [re-frame.loggers :refer [console]]\n            [re-frame.trace   :as trace :include-macros true]))\n\n\n;; -- Router Loop ------------------------------------------------------------\n;;\n;; A call to \"re-frame.core/dispatch\" places an event on a queue for processing.\n;; A short time later, the handler registered to handle this event will be run.\n;; What follows is the implementation of this process.\n;;\n;; The task is to process queued events in a perpetual loop, one after\n;; the other, FIFO, calling the registered event-handler for each, being idle when\n;; there are no events, and firing up when one arrives.\n;;\n;; But browsers only have a single thread of control and we must be\n;; careful to not hog the CPU. When processing events one after another, we\n;; must regularly hand back control to the browser, so it can redraw, process\n;; websockets, etc. But not too regularly! If we are in a de-focused browser\n;; tab, our app will be CPU throttled. Each time we get back control, we have\n;; to process all queued events, or else something like a bursty websocket\n;; (producing events) might overwhelm the queue. So there's a balance.\n;;\n;; The processing/handling of an event happens \"asynchronously\" sometime after\n;; that event was enqueued via \"dispatch\". The original implementation of this router loop\n;; used `core.async`. As a result, it was fairly simple, and it mostly worked,\n;; but it did not give enough control. So now we hand-roll our own,\n;; finite-state-machine and all.\n;;\n;; In what follows, the strategy is this:\n;;   - maintain a FIFO queue of `dispatched` events.\n;;   - when a new event arrives, \"schedule\" processing of this queue using\n;;     goog.async.nextTick, which means it will happen \"very soon\".\n;;   - when processing events, one after the other, do ALL the currently\n;;     queued events. Don't stop. Don't yield to the browser. Hog that CPU.\n;;   - but if any new events are dispatched during this cycle of processing,\n;;     don't do them immediately. Leave them queued. Yield first to the browser,\n;;     and do these new events in the next processing cycle. That way we drain\n;;     the queue up to a point, but we never hog the CPU forever. In\n;;     particular, we handle the case where handling one event will beget\n;;     another event. The freshly begotten event will be handled next cycle,\n;;     with yielding in-between.\n;;   - In some cases, an event should not be handled until after the GUI has been\n;;     updated, i.e., after the next Reagent animation frame. In such a case,\n;;     the event should be dispatched with :flush-dom metadata like this:\n;;       (dispatch ^:flush-dom [:event-id other params])\n;;     Such an event will temporarily block all further processing because\n;;     events are processed sequentially: we handle one event completely\n;;     before we handle the ones behind it.\n;;\n;; Implementation notes:\n;;   - queue processing can be in a number of states: scheduled, running, paused\n;;     etc. So it is modeled as a Finite State Machine.\n;;     See \"-fsm-trigger\" (below) for the states and transitions.\n;;   - the scheduling is done via \"goog.async.nextTick\" which is pretty quick\n;;   - when the event has :flush-dom metadata we schedule via\n;;       \"reagent.core.after-render\"\n;;     which will run event processing after the next Reagent animation frame.\n;;\n\n;; Events can have metadata which says to pause event processing.\n;; event metadata -> \"run later\" functions\n(def later-fns\n  {:flush-dom (fn [f] (after-render #(next-tick f)))   ;; one tick after the end of the next annimation frame\n   :yield     next-tick})               ;; almost immediately\n\n\n;; Event Queue Abstraction\n(defprotocol IEventQueue\n\n  ;; -- API\n  (push [this event])\n  (add-post-event-callback [this id callack])\n  (remove-post-event-callback [this f])\n  (purge [this])\n\n  ;; -- Implementation via a Finite State Machine\n  (-fsm-trigger [this trigger arg])\n\n  ;; -- Finite State Machine actions\n  (-add-event [this event])\n  (-process-1st-event-in-queue [this])\n  (-run-next-tick [this])\n  (-run-queue [this])\n  (-exception [this ex])\n  (-pause [this later-fn])\n  (-resume [this])\n  (-call-post-event-callbacks [this event]))\n\n\n;; Concrete implementation of IEventQueue\n(deftype EventQueue [#?(:cljs ^:mutable fsm-state               :clj ^:volatile-mutable fsm-state)\n                     #?(:cljs ^:mutable queue                   :clj ^:volatile-mutable queue)\n                     #?(:cljs ^:mutable post-event-callback-fns :clj ^:volatile-mutable post-event-callback-fns)]\n  IEventQueue\n\n  ;; -- API ------------------------------------------------------------------\n\n  (push [this event]         ;; presumably called by dispatch\n    (-fsm-trigger this :add-event event))\n\n  ;; register a callback function which will be called after each event is processed\n  (add-post-event-callback [_ id callback-fn]\n    (if (contains? post-event-callback-fns id)\n      (console :warn \"re-frame: overwriting existing post event call back with id:\" id))\n    (->> (assoc post-event-callback-fns id callback-fn)\n         (set! post-event-callback-fns)))\n\n  (remove-post-event-callback [_ id]\n    (if-not (contains? post-event-callback-fns id)\n      (console :warn \"re-frame: could not remove post event call back with id:\" id)\n      (->> (dissoc post-event-callback-fns id)\n           (set! post-event-callback-fns))))\n\n  (purge [_]\n    (set! queue empty-queue))\n\n  ;; -- FSM Implementation ---------------------------------------------------\n\n  (-fsm-trigger\n    [this trigger arg]\n\n    ;; The following \"case\" implements the Finite State Machine.\n    ;; Given a \"trigger\", and the existing FSM state, it computes the\n    ;; new FSM state and the transition action (function).\n\n    (trace/with-trace {:op-type ::fsm-trigger}\n      (let [[new-fsm-state action-fn]\n            (case [fsm-state trigger]\n\n              ;; You should read the following \"case\" as:\n              ;; [current-FSM-state trigger] -> [new-FSM-state action-fn]\n              ;;\n              ;; So, for example, the next line should be interpreted as:\n              ;; if you are in state \":idle\" and a trigger \":add-event\"\n              ;; happens, then move the FSM to state \":scheduled\" and execute\n              ;; that two-part \"do\" function.\n              [:idle :add-event] [:scheduled #(do (-add-event this arg)\n                                                  (-run-next-tick this))]\n\n              ;; State: :scheduled  (the queue is scheduled to run, soon)\n              [:scheduled :add-event] [:scheduled #(-add-event this arg)]\n              [:scheduled :run-queue] [:running #(-run-queue this)]\n\n              ;; State: :running (the queue is being processed one event after another)\n              [:running :add-event] [:running #(-add-event this arg)]\n              [:running :pause] [:paused #(-pause this arg)]\n              [:running :exception] [:idle #(-exception this arg)]\n              [:running :finish-run] (if (empty? queue)     ;; FSM guard\n                                       [:idle]\n                                       [:scheduled #(-run-next-tick this)])\n\n              ;; State: :paused (:flush-dom metadata on an event has caused a temporary pause in processing)\n              [:paused :add-event] [:paused #(-add-event this arg)]\n              [:paused :resume] [:running #(-resume this)]\n\n              (throw (ex-info (str \"re-frame: router state transition not found. \" fsm-state \" \" trigger)\n                              {:fsm-state fsm-state, :trigger trigger})))]\n\n        ;; The \"case\" above computed both the new FSM state, and the action. Now, make it happen.\n\n        (trace/merge-trace! {:operation [fsm-state trigger]\n                             :tags      {:current-state fsm-state\n                                         :new-state     new-fsm-state}})\n        (set! fsm-state new-fsm-state)\n        (when action-fn (action-fn)))))\n\n  (-add-event\n    [_ event]\n    (set! queue (conj queue event)))\n\n  (-process-1st-event-in-queue\n    [this]\n    (let [event-v (peek queue)]\n      (try\n        (handle event-v)\n        (set! queue (pop queue))\n        (-call-post-event-callbacks this event-v)\n        (catch #?(:cljs :default :clj Exception) ex\n          (-fsm-trigger this :exception ex)))))\n\n  (-run-next-tick\n    [this]\n    (next-tick #(-fsm-trigger this :run-queue nil)))\n\n  ;; Process all the events currently in the queue, but not any new ones.\n  ;; Be aware that events might have metadata which will pause processing.\n  (-run-queue\n    [this]\n    (loop [n (count queue)]\n      (if (zero? n)\n        (-fsm-trigger this :finish-run nil)\n        (if-let [later-fn (some later-fns (-> queue peek meta keys))]  ;; any metadata which causes pausing?\n          (-fsm-trigger this :pause later-fn)\n          (do (-process-1st-event-in-queue this)\n              (recur (dec n)))))))\n\n  (-exception\n    [this ex]\n    (purge this)   ;; purge the queue\n    (throw ex))\n\n  (-pause\n    [this later-fn]\n    (later-fn #(-fsm-trigger this :resume nil)))\n\n  (-call-post-event-callbacks\n    [_ event-v]\n    (doseq [callback (vals post-event-callback-fns)]\n      (callback event-v queue)))\n\n  (-resume\n    [this]\n    (-process-1st-event-in-queue this)  ;; do the event which paused processing\n    (-run-queue this)))                 ;; do the rest of the queued events\n\n\n;; ---------------------------------------------------------------------------\n;; Event Queue\n;; When \"dispatch\" is called, the event is added into this event queue.  Later,\n;;  the queue will \"run\" and the event will be \"handled\" by the registered function.\n;;\n(def event-queue (->EventQueue :idle empty-queue {}))\n\n\n;; ---------------------------------------------------------------------------\n;; Dispatching\n;;\n\n(defn dispatch\n  \"Enqueue `event` for processing by event handling machinery.\n\n  `event` is a vector of length >= 1. The 1st element identifies the kind of event.\n\n  Note: the event handler is not run immediately - it is not run\n  synchronously. It will likely be run 'very soon', although it may be\n  added to the end of a FIFO queue which already contain events.\n\n  Usage:\n     (dispatch [:order-pizza {:supreme 2 :meatlovers 1 :veg 1})\"\n  [event]\n  (if (nil? event)\n      (throw (ex-info \"re-frame: you called \\\"dispatch\\\" without an event vector.\" {}))\n      (push event-queue event))\n  nil)                                           ;; Ensure nil return. See https://github.com/Day8/re-frame/wiki/Beware-Returning-False\n\n\n(defn dispatch-sync\n  \"Synchronously (immediately) process `event`. Do not queue.\n\n  Generally, don't use this. Instead use `dispatch`. It is an error\n  to use `dispatch-sync` within an event handler.\n\n  Useful when any delay in processing is a problem:\n     1. the `:on-change` handler of a text field where we are expecting fast typing.\n     2  when initialising your app - see 'main' in todomvc examples\n     3. in a unit test where we don't want the action 'later'\n\n  Usage:\n     (dispatch-sync [:sing :falsetto 634])\"\n  [event-v]\n  (handle event-v)\n  (-call-post-event-callbacks event-queue event-v)  ;; slightly ugly hack. Run the registered post event callbacks.\n  nil)                                              ;; Ensure nil return. See https://github.com/Day8/re-frame/wiki/Beware-Returning-False\n"],"mappings":";;;;;;AAgEA,4BAAA,2CAAA,vEAAKA,sIACS,WAAKC;AAAL,AAAQ,IAAAC,WAAA;AAAA,AAAe,QAACE,2DAAAA,8DAAAA,LAAUH,0CAAAA;;AAA1B,AAAA,kIAAAC,oDAAAA,9KAACC,8DAAAA,wEAAAA;GADvB,sDAEcC;AAId,AAAA;AAAA;;;8BAAA,9BAAakB;;AAAb,uBAAA,vBAGGC,sDAAMC,MAAKC;AAHd,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,kDAAA,1EAGSD,wBAAAA;AAHT,OAGSA,+CAAAA,MAAKC;;AAHd,IAAApB,kBAAA,EAAA,UAAA,OAAA,hBAGSmB,qBAAAA;IAHTlB,kBAAA,CAAAC,qBAAA,AAAAC,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,6DAAAA,fAGSkB,yCAAAA,nCAAKC,yCAAAA;;AAHd,IAAAnB,sBAAA,CAAAC,qBAAA;AAAA,AAAA,GAAA,EAAA,CAAAD,uBAAA;AAAA,QAAAA,oDAAAA,iEAAAA,fAGSkB,6CAAAA,vCAAKC,6CAAAA;;AAHd,MAAA,AAAAhB,2BAAA,mBAGSe;;;;;;AAHT,0CAAA,1CAIGE,4FAAyBF,MAAKG,GAAGC;AAJpC,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,qEAAA,7FAI4BJ,wBAAAA;AAJ5B,OAI4BA,kEAAAA,MAAKG,GAAGC;;AAJpC,IAAAvB,kBAAA,EAAA,UAAA,OAAA,hBAI4BmB,qBAAAA;IAJ5BlB,kBAAA,CAAAI,wCAAA,AAAAF,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,kEAAAA,pBAI4BkB,8CAAAA,xCAAKG,8CAAAA,3CAAGC,8CAAAA;;AAJpC,IAAAtB,sBAAA,CAAAI,wCAAA;AAAA,AAAA,GAAA,EAAA,CAAAJ,uBAAA;AAAA,QAAAA,oDAAAA,sEAAAA,pBAI4BkB,kDAAAA,5CAAKG,kDAAAA,/CAAGC,kDAAAA;;AAJpC,MAAA,AAAAnB,2BAAA,sCAI4Be;;;;;;AAJ5B,6CAAA,7CAKGK,kGAA4BL,MAAKvB;AALpC,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,wEAAA,hGAK+BuB,wBAAAA;AAL/B,OAK+BA,qEAAAA,MAAKvB;;AALpC,IAAAI,kBAAA,EAAA,UAAA,OAAA,hBAK+BmB,qBAAAA;IAL/BlB,kBAAA,CAAAK,2CAAA,AAAAH,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,yDAAAA,XAK+BkB,qCAAAA,/BAAKvB,qCAAAA;;AALpC,IAAAK,sBAAA,CAAAK,2CAAA;AAAA,AAAA,GAAA,EAAA,CAAAL,uBAAA;AAAA,QAAAA,oDAAAA,6DAAAA,XAK+BkB,yCAAAA,nCAAKvB,yCAAAA;;AALpC,MAAA,AAAAQ,2BAAA,yCAK+Be;;;;;;AAL/B,wBAAA,xBAMGM,wDAAON;AANV,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,mDAAA,3EAMUA,wBAAAA;AANV,OAMUA,gDAAAA;;AANV,IAAAnB,kBAAA,EAAA,UAAA,OAAA,hBAMUmB,qBAAAA;IANVlB,kBAAA,CAAAM,sBAAA,AAAAJ,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,uDAAAA,TAMUkB,mCAAAA;;AANV,IAAAlB,sBAAA,CAAAM,sBAAA;AAAA,AAAA,GAAA,EAAA,CAAAN,uBAAA;AAAA,QAAAA,oDAAAA,2DAAAA,TAMUkB,uCAAAA;;AANV,MAAA,AAAAf,2BAAA,oBAMUe;;;;;;AANV,+BAAA,/BASGO,sEAAcP,MAAKQ,QAAQC;AAT9B,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,0DAAA,lFASiBT,wBAAAA;AATjB,OASiBA,uDAAAA,MAAKQ,QAAQC;;AAT9B,IAAA5B,kBAAA,EAAA,UAAA,OAAA,hBASiBmB,qBAAAA;IATjBlB,kBAAA,CAAAO,6BAAA,AAAAL,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,mEAAAA,rBASiBkB,+CAAAA,zCAAKQ,+CAAAA,vCAAQC,+CAAAA;;AAT9B,IAAA3B,sBAAA,CAAAO,6BAAA;AAAA,AAAA,GAAA,EAAA,CAAAP,uBAAA;AAAA,QAAAA,oDAAAA,uEAAAA,rBASiBkB,mDAAAA,7CAAKQ,mDAAAA,3CAAQC,mDAAAA;;AAT9B,MAAA,AAAAxB,2BAAA,2BASiBe;;;;;;AATjB,6BAAA,7BAYGU,kEAAYV,MAAKC;AAZpB,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,wDAAA,hFAYeD,wBAAAA;AAZf,OAYeA,qDAAAA,MAAKC;;AAZpB,IAAApB,kBAAA,EAAA,UAAA,OAAA,hBAYemB,qBAAAA;IAZflB,kBAAA,CAAAQ,2BAAA,AAAAN,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,6DAAAA,fAYekB,yCAAAA,nCAAKC,yCAAAA;;AAZpB,IAAAnB,sBAAA,CAAAQ,2BAAA;AAAA,AAAA,GAAA,EAAA,CAAAR,uBAAA;AAAA,QAAAA,oDAAAA,iEAAAA,fAYekB,6CAAAA,vCAAKC,6CAAAA;;AAZpB,MAAA,AAAAhB,2BAAA,yBAYee;;;;;;AAZf,8CAAA,9CAaGW,oGAA6BX;AAbhC,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,yEAAA,jGAagCA,wBAAAA;AAbhC,OAagCA,sEAAAA;;AAbhC,IAAAnB,kBAAA,EAAA,UAAA,OAAA,hBAagCmB,qBAAAA;IAbhClB,kBAAA,CAAAS,4CAAA,AAAAP,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,uDAAAA,TAagCkB,mCAAAA;;AAbhC,IAAAlB,sBAAA,CAAAS,4CAAA;AAAA,AAAA,GAAA,EAAA,CAAAT,uBAAA;AAAA,QAAAA,oDAAAA,2DAAAA,TAagCkB,uCAAAA;;AAbhC,MAAA,AAAAf,2BAAA,0CAagCe;;;;;;AAbhC,iCAAA,jCAcGY,0EAAgBZ;AAdnB,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,4DAAA,pFAcmBA,wBAAAA;AAdnB,OAcmBA,yDAAAA;;AAdnB,IAAAnB,kBAAA,EAAA,UAAA,OAAA,hBAcmBmB,qBAAAA;IAdnBlB,kBAAA,CAAAU,+BAAA,AAAAR,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,uDAAAA,TAcmBkB,mCAAAA;;AAdnB,IAAAlB,sBAAA,CAAAU,+BAAA;AAAA,AAAA,GAAA,EAAA,CAAAV,uBAAA;AAAA,QAAAA,oDAAAA,2DAAAA,TAcmBkB,uCAAAA;;AAdnB,MAAA,AAAAf,2BAAA,6BAcmBe;;;;;;AAdnB,6BAAA,7BAeGa,kEAAYb;AAff,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,wDAAA,hFAeeA,wBAAAA;AAff,OAeeA,qDAAAA;;AAff,IAAAnB,kBAAA,EAAA,UAAA,OAAA,hBAeemB,qBAAAA;IAfflB,kBAAA,CAAAW,2BAAA,AAAAT,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,uDAAAA,TAeekB,mCAAAA;;AAff,IAAAlB,sBAAA,CAAAW,2BAAA;AAAA,AAAA,GAAA,EAAA,CAAAX,uBAAA;AAAA,QAAAA,oDAAAA,2DAAAA,TAeekB,uCAAAA;;AAff,MAAA,AAAAf,2BAAA,yBAeee;;;;;;AAff,6BAAA,7BAgBGc,kEAAYd,MAAKe;AAhBpB,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,wDAAA,hFAgBef,wBAAAA;AAhBf,OAgBeA,qDAAAA,MAAKe;;AAhBpB,IAAAlC,kBAAA,EAAA,UAAA,OAAA,hBAgBemB,qBAAAA;IAhBflB,kBAAA,CAAAY,2BAAA,AAAAV,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,0DAAAA,ZAgBekB,sCAAAA,hCAAKe,sCAAAA;;AAhBpB,IAAAjC,sBAAA,CAAAY,2BAAA;AAAA,AAAA,GAAA,EAAA,CAAAZ,uBAAA;AAAA,QAAAA,oDAAAA,8DAAAA,ZAgBekB,0CAAAA,pCAAKe,0CAAAA;;AAhBpB,MAAA,AAAA9B,2BAAA,yBAgBee;;;;;;AAhBf,yBAAA,zBAiBGgB,0DAAQhB,MAAKiB;AAjBhB,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,oDAAA,5EAiBWjB,wBAAAA;AAjBX,OAiBWA,iDAAAA,MAAKiB;;AAjBhB,IAAApC,kBAAA,EAAA,UAAA,OAAA,hBAiBWmB,qBAAAA;IAjBXlB,kBAAA,CAAAa,uBAAA,AAAAX,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,gEAAAA,lBAiBWkB,4CAAAA,tCAAKiB,4CAAAA;;AAjBhB,IAAAnC,sBAAA,CAAAa,uBAAA;AAAA,AAAA,GAAA,EAAA,CAAAb,uBAAA;AAAA,QAAAA,oDAAAA,oEAAAA,lBAiBWkB,gDAAAA,1CAAKiB,gDAAAA;;AAjBhB,MAAA,AAAAhC,2BAAA,qBAiBWe;;;;;;AAjBX,0BAAA,1BAkBGkB,4DAASlB;AAlBZ,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,qDAAA,7EAkBYA,wBAAAA;AAlBZ,OAkBYA,kDAAAA;;AAlBZ,IAAAnB,kBAAA,EAAA,UAAA,OAAA,hBAkBYmB,qBAAAA;IAlBZlB,kBAAA,CAAAc,wBAAA,AAAAZ,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,uDAAAA,TAkBYkB,mCAAAA;;AAlBZ,IAAAlB,sBAAA,CAAAc,wBAAA;AAAA,AAAA,GAAA,EAAA,CAAAd,uBAAA;AAAA,QAAAA,oDAAAA,2DAAAA,TAkBYkB,uCAAAA;;AAlBZ,MAAA,AAAAf,2BAAA,sBAkBYe;;;;;;AAlBZ,6CAAA,7CAmBGmB,kGAA4BnB,MAAKC;AAnBpC,AAAA,GAAA,EAAA,EAAA,UAAA,YAAA,EAAA,CAAA,wEAAA,hGAmB+BD,wBAAAA;AAnB/B,OAmB+BA,qEAAAA,MAAKC;;AAnBpC,IAAApB,kBAAA,EAAA,UAAA,OAAA,hBAmB+BmB,qBAAAA;IAnB/BlB,kBAAA,CAAAe,2CAAA,AAAAb,YAAAH;AAAA,AAAA,GAAA,EAAA,CAAAC,mBAAA;AAAA,QAAAA,gDAAAA,6DAAAA,fAmB+BkB,yCAAAA,nCAAKC,yCAAAA;;AAnBpC,IAAAnB,sBAAA,CAAAe,2CAAA;AAAA,AAAA,GAAA,EAAA,CAAAf,uBAAA;AAAA,QAAAA,oDAAAA,iEAAAA,fAmB+BkB,6CAAAA,vCAAKC,6CAAAA;;AAnBpC,MAAA,AAAAhB,2BAAA,yCAmB+Be;;;;;;AAnB/B,AAuBA,AAAA;;;;;;;;;;AAAA,AAAA,AAAA,AAAA,oEAAAoB,pEAASK;;AAAT,AAAA,AAAA,sFAAA,tFAASA,iGAiGJzB;;AAjGL,AAAA,gBAAA,ZAiGKA;AAjGL,AAkGI,IAAOsE,IAAE,AAACC,gBAAM3C;;AAAhB,AACE,GAAI,OAAA,NAAO0C;AACT,uEAAA,gEAAA,hIAActE;;AACd,IAAAwE,qBAAkB,AAACC,eAAKjG,0BAAU,eAAA,eAAA,eAAIoD,fAAMqC,fAAKS,fAAKC;AAAtD,AAAA,oBAAAH;AAAA,eAAAA,XAASvD;AAAT,AACE,uEAAA,hEAAcjB,wHAAYiB;;AAC1B,AAAI,AAA6BjB;;AAC7B,eAAO,KAAA,JAAKsE;;;;;;;;;AAxG1B,AAAA,AAAA,sGAAA,tGAAS7C,iHAiBsBK,EAAE3B;;AAjBjC,AAAA,YAAA,RAiB+B2B;AAjB/B,AAkBI,GAAA,EAAQ,AAACE,0BAAUH,+BAAwB1B;AACzC,qEAAA,uGAAA,rKAAC8B,gOAAyE9B;;wCACrE,AAACgC,+CAAON,+BAAwB1B,tHAChC,OAAM0B;;;;AArBjB,AAAA,AAAA,sFAAA,tFAASJ,iGA6EJK,EAAE7B;;AA7EP,AAAA,YAAA,RA6EK6B;AA7EL,AA8EI,OAAMF,eAAM,AAACmC,6CAAKnC,aAAM3B;;;AA9E5B,AAAA,AAAA,mFAAA,nFAASwB,8FAyHJzB;;AAzHL,AAAA,gBAAA,ZAyHKA;AAzHL,AA0HI,AAA6BA;;AAC7B,OAAYA;;;AA3HhB,AAAA,AAAA,gFAAA,hFAASyB,2FAOAzB,MAAKC;;AAPd,AAAA,gBAAA,ZAOSD;AAPT,AAQI,uEAAA,hEAAcA,8HAAgBC;;;AARlC,AAAA,AAAA,0FAAA,1FAASwB,qGA2FJzB;;AA3FL,AAAA,gBAAA,ZA2FKA;AA3FL,AA4FI,IAAAqE,WAAA;;AAAA,AAAY,uEAAA,gEAAA,hIAAcrE;;;AAA1B,AAAA,4HAAAqE,iDAAAA,rKAACzF,2DAAAA,qEAAAA;;;AA5FL,AAAA,AAAA,wFAAA,xFAAS6C,mGA6BJzB,MAAKQ,QAAQC;;AA7BlB,AAAA,gBAAA,ZA6BKT;AA7BL,AAmCI,GAAA,AAAAqC;AAAA,IAAAC,iCAAAC;AAAA,AAAA,AAAAA,2CAAA,AAAAC,2BAAA,2CAAA,4DAAA;;AAAA,IAAA,AAAA,IAAA,AACE,IAAAS,aACM,iBAAAK,WAAA,mFAAO3B,iBAAUnB;AAAjB,AAAA,GAAA,AAAA+C,6CAAA,mFAAA,sDAAA,sEAAAD;AAAA,0FAAA,8DAAA;;AAAA,AASkC,AAAI,AAAYtD,8DAAKS;;AACjB,OAAgBT;;;;AAVtD,GAAA,AAAAuD,6CAAA,mFAAA,8DAAA,sEAAAD;AAAA,0FAAA,8DAAA;;AAAA,AAauC,OAAYtD,8DAAKS;;;;AAbxD,GAAA,AAAA8C,6CAAA,mFAAA,8DAAA,wEAAAD;AAAA,0FAAA,2DAAA;;AAAA,AAcqC,OAAYtD;;;;AAdjD,GAAA,AAAAuD,6CAAA,mFAAA,2DAAA,sEAAAD;AAAA,0FAAA,2DAAA;;AAAA,AAiBmC,OAAYtD,8DAAKS;;;;AAjBpD,GAAA,AAAA8C,6CAAA,mFAAA,2DAAA,gEAAAD;AAAA,0FAAA,0DAAA;;AAAA,AAkB8B,OAAQtD,0DAAKS;;;;AAlB3C,GAAA,AAAA8C,6CAAA,mFAAA,2DAAA,uEAAAD;AAAA,0FAAA,sDAAA;;AAAA,AAmBgC,OAAYtD,8DAAKS;;;;AAnBjD,GAAA,AAAA8C,6CAAA,mFAAA,2DAAA,wEAAAD;AAoByB,GAAI,AAACG,uBAAO7B;AAAZ,0FAAA;;AAAA,0FAAA,8DAAA;;AAAA,AAEe,OAAgB5B;;;;;AAtBxD,GAAA,AAAAuD,6CAAA,mFAAA,0DAAA,sEAAAD;AAAA,0FAAA,0DAAA;;AAAA,AAyBiC,OAAYtD,8DAAKS;;;;AAzBlD,GAAA,AAAA8C,6CAAA,mFAAA,0DAAA,iEAAAD;AAAA,0FAAA,2DAAA;;AAAA,AA0B+B,OAAStD;;;;AA1BxC,AA4BE,MAAO,kOAAA,2CAAA,gFAAA,7VAAC0D,gDAAQ,CAAA,8GAAA,lBAAqD/B,kEAAcnB,6HACvDmB,2EAAoBnB;;;;;;;;;;;;oBA9BxD,AAAA0C,4CAAAD,WAAA,IAAA,3EAAOG;gBAAP,AAAAF,4CAAAD,WAAA,IAAA,vEAAqBI;AAArB,AAkCE,GAAA,AAAAhB;AAAA,AAAA,IAAAsB,iCAAA,AAAAC,uGAAA,AAAAC,+CAAAtB,yCAAA,qDAAAuB,gBAAA,AAAA,mFAAA,2CAAA,gEAAA,oHAAA,qDAAA,2CAAA,wFAAA,+FAAA,AAAA3B,+CAAA,2CAAA,gEAAA,oHAAA,qDAAA,2CAAA,wFAAA,6FAAA,31BAAiCR,qiBAAAA,phBAAUnB,qiBAAAA,9WACKmB,qiBAAAA,rdACAyB,qiBAAAA;AAFhD,AAAA,AAAAb,2CAAAoB;;AAAA;AAAA;;AAGA,AAAMhC,mBAAUyB;;AAChB,oBAAMC;AAAN,AAAgB,QAACA,0CAAAA,4CAAAA;;AAAjB;;UAvCJ,AAAA,GAAA,AAAAhB;AAAA,AAAA,IAAAI,2BAAA,AAAAC;IAAAC,gCAAA,CAAAF,2BAAA,AAAA,qFAAAF;AAAA,AAAA,AAAAK,mDAAAC,sBAAAC,eAAA,AAAAC,qDAAAR,yCAAA,6DAAAI,gFAAA,mDAAA,AAAAD;;AAAA,AAAAM,2CAAAP;;AAAA;WAAA,AAAA,AAAAF,2CAAAD;;AAAA,AACE,IAAAa,aACM,iBAAAK,WAAA,mFAAO7B,iBAAUnB;AAAjB,AAAA,GAAA,AAAA+C,6CAAA,mFAAA,sDAAA,sEAAAC;AAAA,0FAAA,8DAAA;;AAAA,AASkC,AAAI,AAAYxD,8DAAKS;;AACjB,OAAgBT;;;;AAVtD,GAAA,AAAAuD,6CAAA,mFAAA,8DAAA,sEAAAC;AAAA,0FAAA,8DAAA;;AAAA,AAauC,OAAYxD,8DAAKS;;;;AAbxD,GAAA,AAAA8C,6CAAA,mFAAA,8DAAA,wEAAAC;AAAA,0FAAA,2DAAA;;AAAA,AAcqC,OAAYxD;;;;AAdjD,GAAA,AAAAuD,6CAAA,mFAAA,2DAAA,sEAAAC;AAAA,0FAAA,2DAAA;;AAAA,AAiBmC,OAAYxD,8DAAKS;;;;AAjBpD,GAAA,AAAA8C,6CAAA,mFAAA,2DAAA,gEAAAC;AAAA,0FAAA,0DAAA;;AAAA,AAkB8B,OAAQxD,0DAAKS;;;;AAlB3C,GAAA,AAAA8C,6CAAA,mFAAA,2DAAA,uEAAAC;AAAA,0FAAA,sDAAA;;AAAA,AAmBgC,OAAYxD,8DAAKS;;;;AAnBjD,GAAA,AAAA8C,6CAAA,mFAAA,2DAAA,wEAAAC;AAoByB,GAAI,AAACC,uBAAO7B;AAAZ,0FAAA;;AAAA,0FAAA,8DAAA;;AAAA,AAEe,OAAgB5B;;;;;AAtBxD,GAAA,AAAAuD,6CAAA,mFAAA,0DAAA,sEAAAC;AAAA,0FAAA,0DAAA;;AAAA,AAyBiC,OAAYxD,8DAAKS;;;;AAzBlD,GAAA,AAAA8C,6CAAA,mFAAA,0DAAA,iEAAAC;AAAA,0FAAA,2DAAA;;AAAA,AA0B+B,OAASxD;;;;AA1BxC,AA4BE,MAAO,kOAAA,2CAAA,gFAAA,7VAAC0D,gDAAQ,CAAA,8GAAA,lBAAqD/B,kEAAcnB,6HACvDmB,2EAAoBnB;;;;;;;;;;;;oBA9BxD,AAAA0C,4CAAAC,WAAA,IAAA,3EAAOC;gBAAP,AAAAF,4CAAAC,WAAA,IAAA,vEAAqBE;AAArB,AAkCE,GAAA,AAAAhB;AAAA,AAAA,IAAAsB,iCAAA,AAAAC,uGAAA,AAAAC,+CAAAtB,yCAAA,qDAAAuB,gBAAA,AAAA,mFAAA,2CAAA,gEAAA,oHAAA,qDAAA,2CAAA,wFAAA,+FAAA,AAAA3B,+CAAA,2CAAA,gEAAA,oHAAA,qDAAA,2CAAA,wFAAA,6FAAA,31BAAiCR,qiBAAAA,phBAAUnB,qiBAAAA,9WACKmB,qiBAAAA,rdACAyB,qiBAAAA;AAFhD,AAAA,AAAAb,2CAAAoB;;AAAA;AAAA;;AAGA,AAAMhC,mBAAUyB;;AAChB,oBAAMC;AAAN,AAAgB,QAACA,0CAAAA,4CAAAA;;AAAjB;;;;;AA1ER,AAAA,AAAA,kFAAA,lFAAS5B,6FAgHJzB,MAAKiB;;AAhHV,AAAA,gBAAA,ZAgHKjB;AAhHL,AAiHI,IAAA4E,WAAA;;AAAA,AAAW,uEAAA,yDAAA,zHAAc5E;;;AAAzB,AAAA,wFAAA4E,+BAAAA,/GAAC3D,yCAAAA,mDAAAA;;;AAjHL,AAAA,AAAA,mGAAA,nGAASQ,8GAWmBK,EAAE3B,GAAG4B;;AAXjC,AAAA,YAAA,RAW4BD;AAX5B,AAYI,GAAI,AAACE,0BAAUH,+BAAwB1B;AACrC,8DAAA,uGAAA,rKAAC8B,oOAA6E9B;;AADhF;;wCAEK,AAAC+B,8CAAML,+BAAwB1B,GAAG4B,xHAClC,OAAMF;;;AAff,AAAA,AAAA,uGAAA,vGAASJ,kHAiFJzB;;AAjFL,AAAA,gBAAA,ZAiFKA;AAjFL,AAkFI,IAAMgE,UAAQ,AAACC,eAAKrC;AAApB,AACE,IAAA,AACE,AAACuC,uBAAOH;;AACR,AAAMpC,eAAM,AAACwC,cAAIxC;;AACjB,OAA4B5B,8EAAKgE;gBAHnC,SAAAE,LAI2CnD;AAJ3C,AAKI,uEAAA,hEAAcf,+HAAgBe;;;AAxFxC,AAAA,AAAA,sGAAA,tGAASU,iHAoHJK,EAAEkC;;AApHP,AAAA,YAAA,RAoHKlC;AApHL,AAqHI,IAAA+C,aAAA,AAAAC,cAAiB,AAACY,eAAK7D;IAAvBkD,eAAA;IAAAC,eAAA;IAAAC,WAAA;;AAAA,AAAA,GAAA,AAAA,CAAAA,WAAAD;AAAA,eAAA,AAAAD,kDAAAE,7DAAQQ;AAAR,AAAA,AACE,CAACA,yCAAAA,+DAAAA,xBAASzB,2CAAAA,nCAAQpC,2CAAAA;;AADpB;AAAA,eAAAiD;eAAAE;eAAAC;eAAA,CAAAC,WAAA;;;;;;;AAAA,IAAAC,qBAAA,AAAAJ,cAAAD;AAAA,AAAA,GAAAK;AAAA,AAAA,IAAAL,iBAAAK;AAAA,AAAA,GAAA,AAAAC,6BAAAN;AAAA,IAAAO,kBAAA,AAAAC,sBAAAR;AAAA,AAAA,eAAA,AAAAS,qBAAAT;eAAAO;eAAA,AAAAb,gBAAAa;eAAA;;;;;;;AAAA,eAAA,AAAAG,gBAAAV,3BAAQY;AAAR,AAAA,AACE,CAACA,yCAAAA,+DAAAA,xBAASzB,2CAAAA,nCAAQpC,2CAAAA;;AADpB;AAAA,eAAA,AAAA4D,eAAAX;eAAA;eAAA;eAAA;;;;;;;;AAAA;;;;;;;AArHJ,AAAA,AAAA,iFAAA,jFAASpD,4FAuBCK;;AAvBV,AAAA,YAAA,RAuBUA;AAvBV,AAwBI,OAAMF,eAAMQ;;;AAxBhB,AAAA,AAAA,sFAAA,tFAASX,iGA2GJzB,MAAKe;;AA3GV,AAAA,gBAAA,ZA2GKf;AA3GL,AA4GI,AAAOA;;AACP,MAAOe;;;AA7GX,AAAA,sCAAA,tCAASU;AAAT,AAAA,0FAAA,oBAAA,mEAAA,2CAAA,0DAAA,cAAA,oBAAA,4DAAA,2CAAA,0DAAA,cAAA,oBAAA,+FAAA,2CAAA,0DAAA;;;AAAA,AAAA,4CAAA,5CAASA;;AAAT,AAAA,+CAAA,/CAASA;;AAAT,AAAA,oDAAA,WAAAJ,mBAAAC,qBAAAC,vGAASE;AAAT,AAAA,OAAAD,iBAAAF,qBAAA;;;AAAA;;;kCAAA,lCAASI,4EAA+BC,UACAC,MACAC;AAFxC,AAAA,YAAAJ,2BAAwCE,UACAC,MACAC;;;AAF/BJ,AAmIT,AAAKkE,8BAAY,gCAAA,mFAAA,nHAACjE,sFAAmBU;AAOrC;;;;;;;;;;;;2BAAA,3BAAMwD,8DAWH3F;AAXH,AAYE,GAAI,UAAA,TAAMA;AACN,MAAO,gDAAA,6DAAA,7GAACyD;;AACR,AAAC3D,qBAAK4F,4BAAY1F;;;AAdxB;;AAkBA;;;;;;;;;;;;;;gCAAA,hCAAM4F,wEAaH7B;AAbH,AAcE,AAACG,uBAAOH;;AACR,AAAC7C,2CAA2BwE,4BAAY3B;;AAf1C","names":["re-frame.router/later-fns","f","G__27218","re-frame.interop/after-render","re-frame.interop/next-tick","x__4243__auto__","m__4244__auto__","re-frame/router.push","goog/typeOf","cljs.core/missing-protocol","re-frame/router.add-post-event-callback","re-frame/router.remove-post-event-callback","re-frame/router.purge","re-frame/router.-fsm-trigger","re-frame/router.-add-event","re-frame/router.-process-1st-event-in-queue","re-frame/router.-run-next-tick","re-frame/router.-run-queue","re-frame/router.-exception","re-frame/router.-pause","re-frame/router.-resume","re-frame/router.-call-post-event-callbacks","re-frame.router/IEventQueue","re-frame.router/push","this","event","re-frame.router/add-post-event-callback","id","callack","re-frame.router/remove-post-event-callback","re-frame.router/purge","re-frame.router/-fsm-trigger","trigger","arg","re-frame.router/-add-event","re-frame.router/-process-1st-event-in-queue","re-frame.router/-run-next-tick","re-frame.router/-run-queue","re-frame.router/-exception","ex","re-frame.router/-pause","later-fn","re-frame.router/-resume","re-frame.router/-call-post-event-callbacks","cljs.core/PROTOCOL_SENTINEL","this__4192__auto__","writer__4193__auto__","opt__4194__auto__","cljs.core/-write","re-frame.router/EventQueue","re-frame.router/->EventQueue","fsm-state","queue","post-event-callback-fns","_","callback-fn","cljs.core/contains?","re_frame.loggers.console.cljs$core$IFn$_invoke$arity$variadic","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","cljs.core.dissoc.cljs$core$IFn$_invoke$arity$2","re-frame.interop/empty-queue","re-frame.trace/is-trace-enabled?","*current-trace*27266","re-frame.trace/*current-trace*","re-frame.trace/start-trace","end__20807__auto__","re-frame.interop/now","duration__20808__auto__","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$3","re-frame.trace/traces","cljs.core/conj","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic","re-frame.trace/run-tracing-callbacks!","vec__27277","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","vec__27286","new-fsm-state","action-fn","G__27280","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","G__27289","cljs.core/empty?","cljs.core.ex_info.cljs$core$IFn$_invoke$arity$2","new-trace__20809__auto__","cljs.core.merge.cljs$core$IFn$_invoke$arity$variadic","cljs.core.update.cljs$core$IFn$_invoke$arity$4","cljs.core/merge","cljs.core.conj.cljs$core$IFn$_invoke$arity$2","event-v","cljs.core/peek","e27296","re-frame.events/handle","cljs.core/pop","G__27259","n","cljs.core/count","temp__5455__auto__","cljs.core/some","cljs.core/meta","cljs.core/keys","G__27295","seq__27298","cljs.core/seq","chunk__27301","count__27302","i__27303","temp__5457__auto__","cljs.core/chunked-seq?","c__4351__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/first","cljs.core/next","callback","cljs.core/vals","re-frame.router/event-queue","re-frame.router/dispatch","re-frame.router/dispatch-sync"]}